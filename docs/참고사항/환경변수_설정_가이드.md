# ğŸ”§ í™˜ê²½ ë³€ìˆ˜ ì„¤ì • ê°€ì´ë“œ

## ğŸ“‹ ëª©ì°¨
1. [ë¡œì»¬ ê°œë°œ í™˜ê²½](#1-ë¡œì»¬-ê°œë°œ-í™˜ê²½)
2. [Vercel í”„ë¡œë•ì…˜ ë°°í¬](#2-vercel-í”„ë¡œë•ì…˜-ë°°í¬)
3. [í™˜ê²½ ë³€ìˆ˜ ëª©ë¡](#3-í™˜ê²½-ë³€ìˆ˜-ëª©ë¡)

---

## 1. ë¡œì»¬ ê°œë°œ í™˜ê²½

### Backend í™˜ê²½ ë³€ìˆ˜

**íŒŒì¼**: `apps/backend/.env`

```bash
# ë°ì´í„°ë² ì´ìŠ¤ (Supabase)
DATABASE_URL="postgresql://postgres.xxx:xxx@3.39.47.126:6543/postgres?pgbouncer=true&sslmode=require"
DIRECT_URL="postgresql://postgres.xxx:xxx@3.39.47.126:5432/postgres?sslmode=require"

# í™˜ê²½ ì„¤ì •
NODE_ENV=development

# CORS ì„¤ì • (ê°œë°œ í™˜ê²½ì—ì„œëŠ” ì£¼ì„ ì²˜ë¦¬)
# FRONTEND_URL=https://your-frontend.vercel.app
```

**ì„¤ëª…**:
- `NODE_ENV=development`: ê°œë°œ í™˜ê²½ì—ì„œëŠ” localhost CORS ìë™ í—ˆìš©
- `FRONTEND_URL`: ì£¼ì„ ì²˜ë¦¬ (ê°œë°œ í™˜ê²½ì—ì„œ ë¶ˆí•„ìš”)

---

### Frontend í™˜ê²½ ë³€ìˆ˜

**íŒŒì¼**: `apps/frontend/.env.local` (ê°œë°œ í™˜ê²½)

```bash
# API ì„œë²„ ì„¤ì •
NEXT_PUBLIC_API_URL=http://localhost:3001

# ë§¤ì¥ ì„¤ì •
NEXT_PUBLIC_STORE_ID=1
NEXT_PUBLIC_USE_MOCK=true  # MSW Mock API ì‚¬ìš©

# ê¸°ë³¸ ë§¤ì¥/ì§€ì 
NEXT_PUBLIC_DEFAULT_STORE_TYPE=tacomolly
NEXT_PUBLIC_DEFAULT_BRANCH_ID=gimpo

# ê°œë°œ ë„êµ¬
NEXT_PUBLIC_ENABLE_QUERY_DEVTOOLS=true
NEXT_PUBLIC_LOG_LEVEL=debug
```

---

## 2. Vercel í”„ë¡œë•ì…˜ ë°°í¬

### Backend (Vercel í™˜ê²½ ë³€ìˆ˜ ì„¤ì •)

#### ë°©ë²• 1: Vercel Dashboard (ì¶”ì²œ)

1. **Vercel Dashboard ì ‘ì†**
   ```
   https://vercel.com/your-team/your-backend-project/settings/environment-variables
   ```

2. **Environment Variables ì¶”ê°€**

   | Key | Value | Environment |
   |-----|-------|-------------|
   | `NODE_ENV` | `production` | Production |
   | `FRONTEND_URL` | `https://order-front-frontend.vercel.app` | Production |
   | `DATABASE_URL` | `postgresql://...` | Production |
   | `DIRECT_URL` | `postgresql://...` | Production |

3. **Redeploy**
   - Settings â†’ Deployments â†’ ìµœì‹  ë°°í¬ â†’ Redeploy

---

#### ë°©ë²• 2: Vercel CLI

```bash
# Vercel CLI ì„¤ì¹˜
npm i -g vercel

# ë¡œê·¸ì¸
vercel login

# í™˜ê²½ ë³€ìˆ˜ ì¶”ê°€
vercel env add FRONTEND_URL production
# ì…ë ¥: https://order-front-frontend.vercel.app

vercel env add NODE_ENV production
# ì…ë ¥: production

# ì¬ë°°í¬
vercel --prod
```

---

### Frontend (Vercel í™˜ê²½ ë³€ìˆ˜ ì„¤ì •)

#### Vercel Dashboardì—ì„œ ì„¤ì •

| Key | Value | Environment |
|-----|-------|-------------|
| `NEXT_PUBLIC_API_URL` | `https://order-front-backend.vercel.app/api/v1` | Production |
| `NEXT_PUBLIC_USE_MOCK` | `false` | Production |
| `NEXT_PUBLIC_ENABLE_QUERY_DEVTOOLS` | `false` | Production |
| `NEXT_PUBLIC_LOG_LEVEL` | `error` | Production |

---

## 3. í™˜ê²½ ë³€ìˆ˜ ëª©ë¡

### Backend í™˜ê²½ ë³€ìˆ˜

| ë³€ìˆ˜ëª… | í•„ìˆ˜ | ê¸°ë³¸ê°’ | ì„¤ëª… |
|--------|------|--------|------|
| `NODE_ENV` | âœ… | `development` | í™˜ê²½ êµ¬ë¶„ (`development` / `production`) |
| `FRONTEND_URL` | âš ï¸ | - | CORS í—ˆìš© Frontend URL (í”„ë¡œë•ì…˜ì—ì„œ í•„ìˆ˜) |
| `DATABASE_URL` | âœ… | - | Supabase Database URL (pgBouncer) |
| `DIRECT_URL` | âœ… | - | Supabase Direct URL (ë§ˆì´ê·¸ë ˆì´ì…˜ìš©) |
| `SUPABASE_URL` | âŒ | - | Supabase í”„ë¡œì íŠ¸ URL (ë¯¸ì‚¬ìš©) |
| `SUPABASE_ANON_KEY` | âŒ | - | Supabase Public Key (ë¯¸ì‚¬ìš©) |
| `OKPOS_API_KEY` | âŒ | - | OKPOS API Key (ë¯¸êµ¬í˜„) |
| `OKPOS_BASE_URL` | âŒ | - | OKPOS API URL (ë¯¸êµ¬í˜„) |

---

### Frontend í™˜ê²½ ë³€ìˆ˜

| ë³€ìˆ˜ëª… | í•„ìˆ˜ | ê¸°ë³¸ê°’ | ì„¤ëª… |
|--------|------|--------|------|
| `NEXT_PUBLIC_API_URL` | âœ… | - | Backend API URL |
| `NEXT_PUBLIC_USE_MOCK` | âŒ | `false` | MSW Mock API ì‚¬ìš© ì—¬ë¶€ |
| `NEXT_PUBLIC_STORE_ID` | âŒ | `1` | ë§¤ì¥ ID |
| `NEXT_PUBLIC_DEFAULT_STORE_TYPE` | âŒ | `tacomolly` | ê¸°ë³¸ ë§¤ì¥ íƒ€ì… |
| `NEXT_PUBLIC_DEFAULT_BRANCH_ID` | âŒ | `gimpo` | ê¸°ë³¸ ì§€ì  ID |
| `NEXT_PUBLIC_ENABLE_QUERY_DEVTOOLS` | âŒ | `false` | React Query DevTools í™œì„±í™” |
| `NEXT_PUBLIC_LOG_LEVEL` | âŒ | `error` | ë¡œê·¸ ë ˆë²¨ (`debug` / `info` / `error`) |

---

## ğŸ”’ ë³´ì•ˆ ê´€ë ¨

### CORS ì •ì±… (Backend)

**ê°œë°œ í™˜ê²½** (`NODE_ENV=development`):
```typescript
// ìë™ìœ¼ë¡œ localhost í—ˆìš©
allowedOrigins = ['http://localhost:3000', 'http://localhost:3001']
```

**í”„ë¡œë•ì…˜ í™˜ê²½** (`NODE_ENV=production`):
```typescript
// FRONTEND_URLë§Œ í—ˆìš©
allowedOrigins = [process.env.FRONTEND_URL]
```

### í™˜ê²½ ë³€ìˆ˜ ëˆ„ë½ ì‹œ ë™ì‘

**Backend**:
- `FRONTEND_URL` ì—†ìŒ â†’ ê¸°ë³¸ê°’ `https://order-front-frontend.vercel.app` ì‚¬ìš©
- `NODE_ENV` ì—†ìŒ â†’ ê¸°ë³¸ê°’ `development` (localhost í—ˆìš©)

**Frontend**:
- `NEXT_PUBLIC_API_URL` ì—†ìŒ â†’ ë¹Œë“œ ì—ëŸ¬ ë°œìƒ
- `NEXT_PUBLIC_USE_MOCK` ì—†ìŒ â†’ ì‹¤ì œ API ì‚¬ìš© (`false`)

---

## ğŸ“ ë°°í¬ ì²´í¬ë¦¬ìŠ¤íŠ¸

### Backend ë°°í¬ ì „

- [ ] `FRONTEND_URL` í™˜ê²½ ë³€ìˆ˜ ì„¤ì •
- [ ] `NODE_ENV=production` ì„¤ì •
- [ ] `DATABASE_URL` í”„ë¡œë•ì…˜ DBë¡œ ë³€ê²½
- [ ] Vercelì—ì„œ í™˜ê²½ ë³€ìˆ˜ í™•ì¸

### Frontend ë°°í¬ ì „

- [ ] `NEXT_PUBLIC_API_URL` Backend URLë¡œ ë³€ê²½
- [ ] `NEXT_PUBLIC_USE_MOCK=false` ì„¤ì •
- [ ] `NEXT_PUBLIC_ENABLE_QUERY_DEVTOOLS=false` ì„¤ì •
- [ ] Vercelì—ì„œ í™˜ê²½ ë³€ìˆ˜ í™•ì¸

---

## ğŸ§ª í…ŒìŠ¤íŠ¸ ë°©ë²•

### ë¡œì»¬ì—ì„œ í”„ë¡œë•ì…˜ ëª¨ë“œ í…ŒìŠ¤íŠ¸

**Backend**:
```bash
# .env íŒŒì¼ ìˆ˜ì •
NODE_ENV=production
FRONTEND_URL=http://localhost:3000

# ë¹Œë“œ & ì‹¤í–‰
pnpm build --filter=backend
pnpm start --filter=backend
```

**Frontend**:
```bash
# í”„ë¡œë•ì…˜ ë¹Œë“œ
pnpm build --filter=frontend

# í”„ë¡œë•ì…˜ ì„œë²„ ì‹¤í–‰
pnpm start --filter=frontend
```

### CORS í…ŒìŠ¤íŠ¸

```bash
# í—ˆìš©ëœ Origin (ì„±ê³µ)
curl -H "Origin: https://your-frontend.vercel.app" \
     http://localhost:3001/api/v1/stores

# í—ˆìš©ë˜ì§€ ì•Šì€ Origin (ì‹¤íŒ¨)
curl -H "Origin: https://malicious-site.com" \
     http://localhost:3001/api/v1/stores
```

---

## ğŸš¨ ë¬¸ì œ í•´ê²°

### CORS ì—ëŸ¬ ë°œìƒ ì‹œ

**ì¦ìƒ**: `Access to fetch at 'https://order-front-backend.vercel.app' from origin 'https://order-front-frontend.vercel.app' has been blocked by CORS policy`

**í•´ê²°**:
1. Backend Vercel í™˜ê²½ ë³€ìˆ˜ í™•ì¸
   - `FRONTEND_URL=https://order-front-frontend.vercel.app` ì •í™•íˆ ì„¤ì •ë˜ì—ˆëŠ”ì§€ í™•ì¸
   - í”„ë¡œí† ì½œ (`https://`) í¬í•¨ í™•ì¸
   - ë§ˆì§€ë§‰ ìŠ¬ë˜ì‹œ (`/`) ì œê±° í™•ì¸

2. Redeploy
   - í™˜ê²½ ë³€ìˆ˜ ë³€ê²½ í›„ ë°˜ë“œì‹œ ì¬ë°°í¬ í•„ìš”

---

### Rate Limiting ì—ëŸ¬ ë°œìƒ ì‹œ

**ì¦ìƒ**: `429 Too Many Requests - ìš”ì²­ì´ ë„ˆë¬´ ë§ìŠµë‹ˆë‹¤. ì ì‹œ í›„ ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”.`

**ì›ì¸**: 1ì´ˆì— 10ê°œ, 1ë¶„ì— 100ê°œ ìš”ì²­ ì œí•œ ì´ˆê³¼

**í•´ê²°**:
- ì¼ë°˜ ì‚¬ìš©: ì ì‹œ ëŒ€ê¸° í›„ ì¬ì‹œë„
- ê°œë°œ/í…ŒìŠ¤íŠ¸: `apps/backend/src/app.module.ts`ì—ì„œ limit ê°’ ì¦ê°€

---

## ğŸ“š ì°¸ê³  ìë£Œ

- [Vercel Environment Variables ë¬¸ì„œ](https://vercel.com/docs/projects/environment-variables)
- [Next.js Environment Variables ë¬¸ì„œ](https://nextjs.org/docs/app/building-your-application/configuring/environment-variables)
- [NestJS Configuration ë¬¸ì„œ](https://docs.nestjs.com/techniques/configuration)
